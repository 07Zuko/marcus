<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goals - Racho AI</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/goals.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path d="M16 2C8.26801 2 2 8.26801 2 16C2 23.732 8.26801 30 16 30C23.732 30 30 23.732 30 16C30 8.26801 23.732 2 16 2Z" stroke="#5046E5" stroke-width="2"/>
                    <path d="M16 8V16L21 21" stroke="#5046E5" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <h1>Racho<span>AI</span></h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="index.html">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M21 12C21 16.9706 16.9706 21 12 21C10.2686 21 8.64511 20.5109 7.25209 19.6495L3 21L4.35046 16.7479C3.48909 15.3549 3 13.7314 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Chat
                        </a>
                    </li>
                    <li class="active">
                        <a href="goals.html">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M20 7L9 18L4 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Goals
                        </a>
                    </li>
                    <li>
                        <a href="tasks.html">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M12 12H15M12 16H15M9 12H9.01M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Tasks
                        </a>
                    </li>
                    <li>
                        <a href="insights.html">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M9 19V13C9 11.8954 8.10457 11 7 11H5C3.89543 11 3 11.8954 3 13V19C3 20.1046 3.89543 21 5 21H7C8.10457 21 9 20.1046 9 19Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M15 7V13C15 14.1046 14.1046 15 13 15H11C9.89543 15 9 14.1046 9 13V7C9 5.89543 9.89543 5 11 5H13C14.1046 5 15 5.89543 15 7Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M21 5V11C21 12.1046 20.1046 13 19 13H17C15.8954 13 15 12.1046 15 11V5C15 3.89543 15.8954 3 17 3H19C20.1046 3 21 3.89543 21 5Z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Insights
                        </a>
                    </li>
                    <li>
                        <a href="logs.html">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M19 4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M16 2V6M8 2V6M3 10H21M8 14H8.01M12 14H12.01M16 14H16.01M8 18H8.01M12 18H12.01M16 18H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Logs
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#settings" class="settings-link">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M18.7273 14.5454C18.6063 14.8156 18.5702 15.1188 18.6236 15.4094C18.677 15.7 18.8173 15.9612 19.0227 16.1591L19.0682 16.2045C19.2361 16.3722 19.3684 16.5726 19.4567 16.7921C19.5451 17.0116 19.5878 17.2457 19.5822 17.4813C19.5766 17.7168 19.5229 17.9485 19.4242 18.163C19.3255 18.3775 19.1839 18.5705 19.0084 18.7292C18.8328 18.888 18.6267 19.0093 18.4022 19.0855C18.1776 19.1618 17.9391 19.1915 17.7039 19.1728C17.4688 19.154 17.2405 19.0872 17.0341 18.9769C16.8277 18.8666 16.6481 18.7152 16.5091 18.5336L16.4636 18.4882C16.2658 18.2827 16.0046 18.1425 15.714 18.089C15.4234 18.0356 15.1202 18.0717 14.85 18.1927C14.5833 18.3088 14.362 18.5016 14.2161 18.7451C14.0701 18.9886 14.0067 19.2699 14.0336 19.55C14.0605 19.8301 14.0768 20.0509 14.0768 20.2123C14.0768 20.6837 13.8893 21.1358 13.5549 21.4703C13.2204 21.8047 12.7683 21.9922 12.2968 21.9922C11.8254 21.9922 11.3733 21.8047 11.0388 21.4703C10.7044 21.1358 10.5168 20.6837 10.5168 20.2123C10.5168 20.0509 10.5305 19.8301 10.5582 19.55C10.5851 19.2699 10.5216 18.9886 10.3757 18.7451C10.2297 18.5016 10.0085 18.3088 9.74182 18.1927C9.4716 18.0717 9.16835 18.0356 8.87778 18.089C8.5872 18.1425 8.32603 18.2827 8.12818 18.4882L8.08273 18.5336C7.94373 18.7152 7.76408 18.8666 7.55768 18.9769C7.35128 19.0872 7.12304 19.154 6.88788 19.1728C6.65272 19.1915 6.41426 19.1618 6.18969 19.0855C5.96512 19.0093 5.75907 18.888 5.58348 18.7292C5.40789 18.5705 5.26625 18.3775 5.16756 18.163C5.06887 17.9485 5.01515 17.7168 5.00957 17.4813C5.00399 17.2457 5.04664 17.0116 5.13501 16.7921C5.22337 16.5726 5.35566 16.3722 5.52364 16.2045L5.56909 16.1591C5.77451 15.9612 5.91485 15.7 5.96822 15.4094C6.02159 15.1188 5.98551 14.8156 5.86454 14.5454C5.74845 14.2787 5.55558 14.0574 5.31209 13.9115C5.0686 13.7655 4.78727 13.7021 4.50727 13.7291C4.22727 13.756 4.00636 13.7722 3.84545 13.7722C3.37403 13.7722 2.92192 13.5847 2.58749 13.2503C2.25306 12.9158 2.06545 12.4637 2.06545 11.9923C2.06545 11.5209 2.25306 11.0688 2.58749 10.7343C2.92192 10.3999 3.37403 10.2123 3.84545 10.2123C4.00636 10.2123 4.22727 10.226 4.50727 10.2536C4.78727 10.2806 5.0686 10.2171 5.31209 10.0712C5.55558 9.92524 5.74845 9.70399 5.86454 9.43727C5.98551 9.16704 6.02159 8.86379 5.96822 8.57322C5.91485 8.28264 5.77451 8.02147 5.56909 7.82363L5.52364 7.77818C5.35566 7.6105 5.22337 7.41009 5.13501 7.19058C5.04664 6.97108 5.00399 6.73695 5.00957 6.50143C5.01515 6.26591 5.06887 6.03418 5.16756 5.81971C5.26625 5.60524 5.40789 5.41224 5.58348 5.25346C5.75907 5.09467 5.96512 4.97326 6.18969 4.89699C6.41426 4.82072 6.65272 4.79104 6.88788 4.80979C7.12304 4.82854 7.35128 4.89534 7.55768 5.00563C7.76408 5.11592 7.94373 5.26737 8.08273 5.44891L8.12818 5.49436C8.32603 5.69979 8.5872 5.84013 8.87778 5.8935C9.16835 5.94687 9.4716 5.91079 9.74182 5.78982H9.83273C10.0994 5.67373 10.3207 5.48086 10.4666 5.23737C10.6126 4.99388 10.676 4.71255 10.6491 4.43255C10.6222 4.15255 10.6059 3.93164 10.6059 3.77073C10.6059 3.2993 10.7935 2.84719 11.128 2.51276C11.4624 2.17833 11.9145 1.99073 12.3859 1.99073C12.8574 1.99073 13.3095 2.17833 13.6439 2.51276C13.9783 2.84719 14.1659 3.2993 14.1659 3.77073C14.1659 3.93164 14.1522 4.15255 14.1245 4.43255C14.0976 4.71255 14.161 4.99388 14.307 5.23737C14.4529 5.48086 14.6742 5.67373 14.9409 5.78982C15.2111 5.91079 15.5144 5.94687 15.8049 5.8935C16.0955 5.84013 16.3567 5.69979 16.5545 5.49436L16.6 5.44891C16.739 5.26737 16.9186 5.11592 17.125 5.00563C17.3314 4.89534 17.5597 4.82854 17.7948 4.80979C18.03 4.79104 18.2684 4.82072 18.493 4.89699C18.7176 4.97326 18.9236 5.09467 19.0992 5.25346C19.2748 5.41224 19.4165 5.60524 19.5151 5.81971C19.6138 6.03418 19.6675 6.26591 19.6731 6.50143C19.6787 6.73695 19.6361 6.97108 19.5477 7.19058C19.4593 7.41009 19.3271 7.6105 19.1591 7.77818L19.1136 7.82363C18.9082 8.02147 18.7679 8.28264 18.7145 8.57322C18.6611 8.86379 18.6972 9.16704 18.8182 9.43727C18.9343 9.70399 19.1271 9.92524 19.3706 10.0712C19.6141 10.2171 19.8954 10.2806 20.1754 10.2536C20.4554 10.226 20.6764 10.2123 20.8373 10.2123C21.3087 10.2123 21.7608 10.3999 22.0952 10.7343C22.4297 11.0688 22.6173 11.5209 22.6173 11.9923C22.6173 12.4637 22.4297 12.9158 22.0952 13.2503C21.7608 13.5847 21.3087 13.7722 20.8373 13.7722C20.6764 13.7722 20.4554 13.756 20.1754 13.7291C19.8954 13.7021 19.6141 13.7655 19.3706 13.9115C19.1271 14.0574 18.9343 14.2787 18.8182 14.5454V14.5454Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Settings
                </a>
                <div class="user-profile">
                    <div class="avatar">JS</div>
                    <div class="user-name">John Smith</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="goals-container">
                <div class="goals-header">
                    <h2>Your Goals</h2>
                    <div class="header-actions">
                        <button class="add-goal-btn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Add New Goal
                        </button>
                    </div>
                </div>
                
                <div class="goals-tabs">
                    <button class="tab-btn active">All Goals</button>
                    <button class="tab-btn">In Progress</button>
                    <button class="tab-btn">Completed</button>
                </div>
                
                <div class="goals-list" id="goals-list">
                    <!-- Empty state will show when no goals exist -->
                    <div class="empty-state" id="empty-goals-state">
                        <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
                            <circle cx="50" cy="50" r="48" stroke="#5046E5" stroke-width="2" stroke-opacity="0.2"/>
                            <path d="M30 50L45 65L70 40" stroke="#5046E5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h3>No goals set yet</h3>
                        <p>Chat with Racho to set your first goal or click the button below</p>
                        <button id="add-goal-btn" class="btn primary-btn" onclick="redirectToChat()">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 4.16667V15.8333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M4.16675 10H15.8334" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Set a New Goal
                        </button>
                    </div>
                    
                    <!-- Goals will be loaded dynamically -->
                </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script>
        // Function to redirect to chat with goal intent
        function redirectToChat() {
            localStorage.setItem('chat_intent', 'create_goal');
            window.location.href = 'index.html';
        }
        
        // Fetch goals when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('http://localhost:3000/api/goals', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // Redirect to login if unauthorized
                        return;
                    }
                    throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Toggle empty state based on goals availability
                const emptyState = document.getElementById('empty-goals-state');
                const goalsList = document.getElementById('goals-list');
                
                if (data.success && data.goals && data.goals.length > 0) {
                    // Hide empty state
                    emptyState.style.display = 'none';
                    
                    // Render goals
                    data.goals.forEach(goal => {
                        const goalElement = createGoalElement(goal);
                        goalsList.appendChild(goalElement);
                    });
                } else {
                    // Show empty state
                    emptyState.style.display = 'flex';
                }
            } catch (error) {
                console.error('Error fetching goals:', error);
                // Show empty state on error
                document.getElementById('empty-goals-state').style.display = 'flex';
            }
        });
        
        // Function to create a goal element
        function createGoalElement(goal) {
            const goalItem = document.createElement('div');
            goalItem.className = 'goal-item';
            
            // Determine status class
            let statusClass = 'not-started';
            if (goal.status === 'completed') {
                statusClass = 'completed';
            } else if (goal.status === 'in progress' || goal.progress > 0) {
                statusClass = 'in-progress';
            }
            
            // Format deadline
            let deadlineText = 'No deadline set';
            if (goal.deadline) {
                const deadlineDate = new Date(goal.deadline);
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                deadlineText = goal.status === 'completed' 
                    ? `Completed: ${deadlineDate.toLocaleDateString('en-US', options)}` 
                    : `Due: ${deadlineDate.toLocaleDateString('en-US', options)}`;
            }
            
            // Create goal HTML
            goalItem.innerHTML = `
                <div class="goal-status ${statusClass}"></div>
                <div class="goal-info">
                    <h3>${goal.title}</h3>
                    <div class="goal-details">
                        <div class="goal-category ${goal.category}">${goal.category.charAt(0).toUpperCase() + goal.category.slice(1)}</div>
                        <div class="goal-deadline">${deadlineText}</div>
                    </div>
                    <div class="goal-progress">
                        <div class="progress-bar">
                            <div class="progress ${goal.status === 'completed' ? 'completed' : ''}" style="width: ${goal.progress}%"></div>
                        </div>
                        <div class="progress-text">${goal.status === 'completed' ? 'Completed' : `${goal.progress}% Complete`}</div>
                    </div>
                </div>
                <div class="goal-actions">
                    <button class="action-btn" onclick="editGoal('${goal._id}')">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M14.1667 2.5H5.83333C4.91286 2.5 4.16667 3.24619 4.16667 4.16667V15.8333C4.16667 16.7538 4.91286 17.5 5.83333 17.5H14.1667C15.0871 17.5 15.8333 16.7538 15.8333 15.8333V4.16667C15.8333 3.24619 15.0871 2.5 14.1667 2.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.5 5.83334H12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            `;
            
            return goalItem;
        }
        
        // Function to handle goal editing
        function editGoal(goalId) {
            // Redirect to chat with the goal ID
            localStorage.setItem('chat_intent', 'edit_goal');
            localStorage.setItem('chat_goal_id', goalId);
            window.location.href = 'index.html';
        }
        
        // Tab switching functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Filter goals based on tab
                const filter = this.textContent.trim().toLowerCase();
                filterGoals(filter);
            });
        });
        
        // Function to filter goals based on tab
        function filterGoals(filter) {
            const goals = document.querySelectorAll('.goal-item');
            
            goals.forEach(goal => {
                const status = goal.querySelector('.goal-status');
                
                if (filter === 'all goals') {
                    goal.style.display = 'flex';
                } else if (filter === 'in progress' && status.classList.contains('in-progress')) {
                    goal.style.display = 'flex';
                } else if (filter === 'completed' && status.classList.contains('completed')) {
                    goal.style.display = 'flex';
                } else {
                    goal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>